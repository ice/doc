<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/tomorrow.min.css" id="tomorrow" />
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/tomorrow-night.min.css" id="tomorrow-night" disabled />
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/style.css" />
    </head>
    <body>
        <header class="navbar navbar-default navbar-fixed-top">
            <div id="top-bar" class="container-fluid">
                <div id="top-left" class="navbar-header">
                    <a href="../../index.html" class="navbar-brand">
                                                    ice Documentation <span class="version">v1.1.1</span>
                                            </a>
                </div>
                <div id="top-right" class="collapse navbar-collapse">

                </div>
            </div>
        </header>
        <div id="body" class="container-fluid">
            <div class="row">
                <div id="body-left" class="col-lg-3 col-sm-4">
                    <div class="header-search">
                        <input class="search-box form-control" placeholder="Search for a class or namespace " type="text" />
                        <div id="menu-wrapper">
                        </div>
                    </div>
                </div>
                <div id="body-right" class="col-lg-9 col-sm-8">
                    <div class="content">
                        
<div>
    
    <ul class="breadcrumb">
        
        <li><a href="../../index.html">Home</a></li>
        
                <li><a href="../../classes.html">Classes</a></li>
                <li><a href="../../class/Ice/Pagination.html">Ice\Pagination</a></li>
                <li><a >Source</a></li>
                
    </ul>
    
</div>
<div class="class-header source clearfix">
    
    <div class="access-buttons pull-right">
        <a class="zep-button btn btn-default" href="../../class/Ice/Pagination.html">Class</a>

                <a class="zep-button btn btn-default" href="https://github.com/ice/framework/tree/dev/ice/pagination.zep">Github</a>
            </div>
    
    <div class="class-full-name">
        
        <span class="class-type">Class</span>
        
                <span class="namespace-piece">
            <a href="../../namespace/Ice.html">Ice</a>
        </span>
                <h1 class="class-name">Pagination</h1>
    </div>
    
</div>


<pre class="zephir-source-file"><code>
namespace Ice;

/**
 * Provide the multi-page pagination component.
 *
 * @package     Ice/Pagination
 * @category    Library
 * @author      Ice Team
 * @copyright   (c) 2014-2015 Ice Team
 * @license     http://iceframework.org/license
 * @uses        Ice\Tag
 */
class Pagination extends Arr
{

    protected di { get };
    protected tag { get };

    /**
     * Pagination constructor. Fetch di and tag.
     *
     * @param array options
     */
    public function __construct(array options = [])
    {
        var di;

        parent::__construct(options);

        let di = Di::$fetch(),
            this-&gt;di = di,
            this-&gt;tag = di-&gt;get(&quot;tag&quot;);
    }

    /**
     * Returns a slice of the resultset to show in the pagination.
     *
     * @return object Pagination
     */
    public function calculate() -&gt; &lt;Pagination&gt;
    {
        var items, data;
        int limit, page, pages, total, previous, next;

        let items  = this-&gt;get(&quot;data&quot;, []);

        if typeof items != &quot;array&quot; &amp;&amp; !(items instanceof Arr) {
            throw new Exception(&quot;Invalid data for pagination&quot;);
        }

        if items instanceof Arr {
            let data = items-&gt;all();
        } else {
            let data = items;
        }

        let limit  = (int) this-&gt;get(&quot;limit&quot;, 10),
            page = (int) this-&gt;get(&quot;page&quot;, 1),
            total = count(items),
            pages = (int) ceil(total / intval(limit ? limit : 1));

        // Make sure page is &gt;= 1
        if page &lt;= 0 {
            let page = 1;
        }

        this-&gt;set(&quot;items&quot;, array_slice(data, limit * (page - 1), limit));

        if page &lt; pages {
            let next = page + 1;
        } else {
            let next = pages;
        }

        this-&gt;set(&quot;next&quot;, next);

        if page &gt; 1 {
            let previous = page - 1;
        } else {
            let previous = 1;
        }

        this-&gt;replace([
            &quot;first&quot;: 1,
            &quot;previous&quot;: previous,
            &quot;current&quot;: page,
            &quot;last&quot;: pages,
            &quot;pages&quot;: pages,
            &quot;total&quot;: total
        ]);

        return this;
    }

    /**
     * Prepare list button.
     *
     * @param mixed page Name or page number
     * @param string url URL with pagination
     * @param boolean active If active create link else span
     * @param string symbol HTML symbol to add
     * @return string HTML
     */
    protected function prepareButton(var page, string url = null, boolean active = false, var symbol = null)
    {
        var query, i18n, title;
        boolean pages = false;

        switch page {
            case &quot;first&quot;:
                let symbol = &quot;&amp;laquo;&quot;;
                break;
            case &quot;previous&quot;:
                let symbol = &quot;&amp;lsaquo;&quot;;
                break;
            case &quot;next&quot;:
                let symbol = &quot;&amp;rsaquo;&quot;;
                break;
            case &quot;last&quot;:
                let symbol = &quot;&amp;raquo;&quot;;
                break;
            default:
                let symbol = !symbol ? page : symbol,
                    pages = true;
                break;
        }

        if !active {
            return &quot;&lt;li class=\&quot;&quot; . (pages ? &quot;active&quot; : &quot;disabled&quot;) . &quot;\&quot;&gt;&lt;span&gt;&quot; . symbol . &quot;&lt;/span&gt;&lt;/li&gt;&quot;;
        }

        let query = this-&gt;di-&gt;get(&quot;request&quot;)-&gt;getQuery(),
            i18n = this-&gt;di-&gt;get(&quot;i18n&quot;);

        if pages {
            let title = i18n ? i18n-&gt;translate(&quot;page: %d&quot;, [page]) : null;
        } else {
            let title = i18n ? i18n-&gt;translate(page) : null,
                page = this-&gt;get(page);
        }

        if this-&gt;has(&quot;query&quot;) &amp;&amp; !this-&gt;get(&quot;query&quot;) {
            // Add /1 to the url
            let url .= (url ? &quot;/&quot; : &quot;&quot;) . page . this-&gt;get(&quot;hash&quot;);
        } else {
            // Don&apos;t add ?page=1 for first page
            if page &gt; 1 {
                query-&gt;set(&quot;page&quot;, page);
            } else {
                query-&gt;remove(&quot;page&quot;);
            }
        }

        return &quot;&lt;li&gt;&quot; . this-&gt;tag-&gt;a([url, symbol, title, &quot;query&quot;: query-&gt;all()]) . &quot;&lt;/li&gt;&quot;;
    }

    /**
     * Prepare minimal pagination.
     * Previous 1 [2] 3 4 5 6 Next
     *
     * @param string url URL with pagination
     * @param string parameters UL attributes to adding
     * @return string HTML
     */
    public function minimal(string url = null, array parameters = [])
    {
        var html;
        int i;

        // Prepare list
        let html = this-&gt;tag-&gt;tagHtml(&quot;ul&quot;, parameters, [&quot;class&quot;: &quot;pagination&quot;]);

        // Prepare previous
        let html .= this-&gt;prepareButton(&quot;previous&quot;, url, this-&gt;get(&quot;current&quot;) &gt; this-&gt;get(&quot;previous&quot;));

        // Prepare pages
        for i in range(1, this-&gt;get(&quot;pages&quot;)) {
            let html .= this-&gt;prepareButton(i, url, i !== this-&gt;get(&quot;current&quot;));
        }

        // Prepare next
        let html .= this-&gt;prepareButton(&quot;next&quot;, url, this-&gt;get(&quot;current&quot;) &lt; this-&gt;get(&quot;next&quot;));

        // Close list
        let html .= this-&gt;tag-&gt;endTag(&quot;ul&quot;);

        return html;
    }

    /**
     * Prepare basic pagination.
     * First Previous 1 [2] 3 4 5 6 Next Last
     *
     * @param string url URL with pagination
     * @param string parameters UL attributes to adding
     * @return string HTML
     */
    public function basic(string url = null, array parameters = [])
    {
        var html;
        int i;

        // Prepare list
        let html = this-&gt;tag-&gt;tagHtml(&quot;ul&quot;, parameters, [&quot;class&quot;: &quot;pagination&quot;]);

        // Prepare first
        let html .= this-&gt;prepareButton(&quot;first&quot;, url, this-&gt;get(&quot;current&quot;) != this-&gt;get(&quot;first&quot;));

        // Prepare previous
        let html .= this-&gt;prepareButton(&quot;previous&quot;, url, this-&gt;get(&quot;current&quot;) &gt; this-&gt;get(&quot;previous&quot;));

        // Prepare pages
        for i in range(1, this-&gt;get(&quot;pages&quot;)) {
            let html .= this-&gt;prepareButton(i, url, i !== this-&gt;get(&quot;current&quot;));
        }

        // Prepare next
        let html .= this-&gt;prepareButton(&quot;next&quot;, url, this-&gt;get(&quot;current&quot;) &lt; this-&gt;get(&quot;next&quot;));

        // Prepare last
        let html .= this-&gt;prepareButton(&quot;last&quot;, url, this-&gt;get(&quot;current&quot;) != this-&gt;get(&quot;last&quot;));

        // Close list
        let html .= this-&gt;tag-&gt;endTag(&quot;ul&quot;);

        return html;
    }


    /**
     * Prepare floating pagination.
     * First Previous 1 2 3 ... 23 24 25 26 [27] 28 29 30 31 ... 48 49 50 Next Last
     *
     * @param string url URL with pagination
     * @param string parameters UL attributes to adding
     * @param int countOut Number of page links in the begin and end of whole range
     * @param int countIn Number of page links on each side of current page
     * @return string HTML
     */
    public function floating(string url = null, array parameters = [], int countOut = 0, int countIn = 2)
    {
        var html, links, page, content;
        boolean useMiddle, useN3, useN6;
        var n2, n4, n5, n7, n8;
        int n1, n3, n6, i;

        if this-&gt;get(&quot;pages&quot;) &lt; 2 {
            return;
        }

        // Beginning group of pages: n1...n2
        let n1 = 1,
            n2 = min(countOut, this-&gt;get(&quot;pages&quot;));

        // Ending group of pages: n7...n8
        let n7 = max(1, this-&gt;get(&quot;pages&quot;) - countOut + 1),
            n8 = this-&gt;get(&quot;pages&quot;);

        // Middle group of pages: n4...n5
        let n4 = max(n2 + 1, this-&gt;get(&quot;current&quot;) - countIn),
            n5 = min(n7 - 1, this-&gt;get(&quot;current&quot;) + countIn),
            useMiddle = (n5 &gt;= n4);

        // Point n3 between n2 and n4
        let n3 = (int) ((n2 + n4) / 2),
            useN3 = (useMiddle &amp;&amp; ((n4 - n2) &gt; 1));

        // Point n6 between n5 and n7
        let n6 = (int) ((n5 + n7) / 2),
            useN6 = (useMiddle &amp;&amp; ((n7 - n5) &gt; 1));

        // Links to display as array(page: content)
        let links = [];

        // Generate links data in accordance with calculated numbers
        for i in range(n1, n2) {
            let links[i] = i;
        }

        if useN3 {
            let links[n3] = &quot;&amp;hellip;&quot;;
        }

        for i in range(n4, n5) {
            let links[i] = i;
        }

        if useN6 {
            let links[n6] = &quot;&amp;hellip;&quot;;
        }

        for i in range(n7, n8) {
            let links[i] = i;
        }

        // Prepare list
        let html = this-&gt;tag-&gt;tagHtml(&quot;ul&quot;, parameters, [&quot;class&quot;: &quot;pagination&quot;]);

        // Prepare first
        let html .= this-&gt;prepareButton(&quot;first&quot;, url, this-&gt;get(&quot;current&quot;) != this-&gt;get(&quot;first&quot;));

        // Prepare previous
        let html .= this-&gt;prepareButton(&quot;previous&quot;, url, this-&gt;get(&quot;current&quot;) &gt; this-&gt;get(&quot;previous&quot;));

        // Prepare pages
        for page, content in links {
            let html .= this-&gt;prepareButton(page, url, page !== this-&gt;get(&quot;current&quot;), content);
        }

        // Prepare next
        let html .= this-&gt;prepareButton(&quot;next&quot;, url, this-&gt;get(&quot;current&quot;) &lt; this-&gt;get(&quot;next&quot;));

        // Prepare last
        let html .= this-&gt;prepareButton(&quot;last&quot;, url, this-&gt;get(&quot;current&quot;) != this-&gt;get(&quot;last&quot;));

        // Close list
        let html .= this-&gt;tag-&gt;endTag(&quot;ul&quot;);

        return html;
    }
}
</code></pre>                    </div>
                </div>
            </div>
        </div>

        <script src="../../asset/static/js/jquery.min.js"></script>
        <script src="../../asset/static/js/bootstrap.min.js"></script>
        <script src="../../asset/static/js/highlight.pack.js"></script>
        <script src="../../asset/static/js/jquery.slimscroll.min.js"></script>
        <script src="../../asset/api_definition.js"></script>

        <script>var ZepCurrentPath = '../../'</script>
        <script src="../../asset/static/js/script.js"></script>
        <script type="text/javascript">
            $(window).on("load resize", function() {
                $('#menu-wrapper').slimscroll({ height: $(window).height() - 100, size: '3px' });
            });
        </script>
        <script type="text/javascript">
            $(document).ready(function() { $('pre code').each(function(i, block) { hljs.highlightBlock(block); }); });
            if ($('.zephir-source-file').length) {
                $('link[id]').each(function(i, link) {
                    link.disabled = (link.id != 'tomorrow-night');
                });
            }
        </script>
            </body>
</html>