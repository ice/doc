<!DOCTYPE html>
<html lang="en">
    <head>
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/bootstrap.min.css" />
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/tomorrow.min.css" id="tomorrow" />
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/tomorrow-night.min.css" id="tomorrow-night" disabled />
        <link rel="stylesheet" type="text/css" href="../../asset/static/css/style.css" />
    </head>
    <body>
        <header class="navbar navbar-default navbar-fixed-top">
            <div id="top-bar" class="container-fluid">
                <div id="top-left" class="navbar-header">
                    <a href="../../index.html" class="navbar-brand">
                                                    ice Documentation <span class="version">v1.2.11</span>
                                            </a>
                </div>
                <div id="top-right" class="collapse navbar-collapse">

                </div>
            </div>
        </header>
        <div id="body" class="container-fluid">
            <div class="row">
                <div id="body-left" class="col-lg-3 col-sm-4">
                    <div class="header-search">
                        <input class="search-box form-control" placeholder="Search for a class or namespace " type="text" />
                        <div id="menu-wrapper">
                        </div>
                    </div>
                </div>
                <div id="body-right" class="col-lg-9 col-sm-8">
                    <div class="content">
                        
<div>
    
    <ul class="breadcrumb">
        
        <li><a href="../../index.html">Home</a></li>
        
                <li><a href="../../classes.html">Classes</a></li>
                <li><a href="../../class/Ice/I18n.html">Ice\I18n</a></li>
                <li><a >Source</a></li>
                
    </ul>
    
</div>
<div class="class-header source clearfix">
    
    <div class="access-buttons pull-right">
        <a class="zep-button btn btn-default" href="../../class/Ice/I18n.html">Class</a>

                <a class="zep-button btn btn-default" href="https://github.com/ice/framework/tree/dev/ice/i18n.zep">Github</a>
            </div>
    
    <div class="class-full-name">
        
        <span class="class-type">Class</span>
        
                <span class="namespace-piece">
            <a href="../../namespace/Ice.html">Ice</a>
        </span>
                <h1 class="class-name">I18n</h1>
    </div>
    
</div>


<pre class="zephir-source-file"><code>/**
 * Global alias of translate method.
 */
function _t(string! str, array values = null, var context = null, string lang = null)
{
    var i18n;

    let i18n = I18n::$fetch();

    if i18n {
        return i18n-&gt;translate(str, values, context, lang);
    }
}

namespace Ice;

use Ice\I18n\Plural;

/**
 * Internationalization (i18n) class.
 *
 * @package     Ice/I18n
 * @category    Library
 * @author      Ice Team
 * @copyright   (c) 2014-2016 Ice Team
 * @license     http://iceframework.org/license
 */
class I18n
{
    
    protected static i18n;
    protected cache = [];
    protected rules = [];
    protected options = [
        &quot;source&quot;: &quot;en-gb&quot;,
        &quot;lang&quot;: &quot;en-gb&quot;,
        &quot;dir&quot;: &quot;&quot;
    ];

    /**
     * I18n constructor.
     *
     * @param array options
     */
    public function __construct(array options = [])
    {
        let this-&gt;options = array_merge(this-&gt;options, options),
            self::i18n = this;
    }

    /**
     * Return the last I18n created.
     *
     * @return I18n
     */
    public static function $fetch()
    {
        return self::i18n;
    }

    /**
     * Get and set the target language.
     *
     * @param string lang New language setting
     * @return string
     */
    public function lang(string lang = null) -&gt; string
    {
        // Normalize the language
        if lang {
            let this-&gt;options[&quot;lang&quot;] = strtolower(str_replace(&quot;_&quot;, &quot;-&quot;, lang));
        }

        return this-&gt;options[&quot;lang&quot;];
    }

    /**
     * Get ISO language code.
     *
     * @param string lang Language
     * @param boolean country Get country code, by default gets language code
     * @return string
     */
    public function iso(var lang = null, boolean country = false) -&gt; string
    {
        var parts;

        if !lang {
            let lang = this-&gt;options[&quot;lang&quot;];
        }

        let parts = explode(&quot;-&quot;, strtolower(str_replace(&quot;_&quot;, &quot;-&quot;, lang)));

        return country &amp;&amp; isset parts[1] ? parts[1] : parts[0];
    }



    /**
     * Returns specified form of a string translation. No parameters are replaced.
     * If no translation exists, the original string will be returned. 
     *
     * @param string str Text to translate
     * @param mixed form If NULL, looking for `other` form, else the very first form
     * @param string lang Target language
     * @return string
     */
    public function get(string str, var form = null, string lang = null) -&gt; string
    {
        var messages, translation;

        let messages = [];

        if !lang {
            // Use the global target language
            let lang = (string) this-&gt;options[&quot;lang&quot;];
        }

        // Load the translation messages for this language
        let messages = this-&gt;load(lang);

        if isset messages[str] {
            let translation = messages[str];

            // If translation is array, return right context
            if typeof translation == &quot;array&quot; {
                // Get a value for the form key
                if array_key_exists(form, translation) {
                    return translation[form];
                } elseif array_key_exists(&quot;other&quot;, translation) {
                    return translation[&quot;other&quot;];
                }

                // Return the very first form
                return reset(translation);
            }

            return translation;
        }

        // If no translation exists, return the original string
        return str;
    }

    /**
     * Load language from the file.
     *
     * @param string lang Language code
     * @return array
     */
    private function load(string lang) -&gt; array
    {
        var cache, parts, subdir, tail, tmp, found, path, messages;

        // Load from the cache
        if fetch cache, this-&gt;cache[lang] {
            return cache;
        }

        let parts = explode(&quot;-&quot;, lang),
            subdir = implode(DIRECTORY_SEPARATOR, parts),
            messages = [];

        // Search for /en/gb.php, /en-gb.php, /en.php or gb.php
        for tail in  [subdir, lang, parts] {
            if typeof tail != &quot;array&quot; {
                let tmp = tail,
                    tail = [tmp];
            }

            for found in tail {
                let path = (string) this-&gt;options[&quot;dir&quot;] . found . &quot;.php&quot;;

                if file_exists(path) {
                    let messages = require path;
                    // Stop searching
                    break;
                }
            }
        }

        let this-&gt;cache[lang] = messages;

        return this-&gt;cache[lang];
    }

    /**
     * Returns translation of a string with right plural form.
     * If no translation exists, the original string will be returned.
     * 
     * @param string string
     * @param int count
     * @param string lang
     * @return string
     */
    public function plural(string! str, int count = 0, string lang = null)
    {
        var rules, form, code;

        let code = this-&gt;iso(lang);

        if !fetch rules, this-&gt;rules[code] {
            // Get language code prefix
            let this-&gt;rules[code] = this-&gt;pluralRules(code),
                rules = this-&gt;rules[code];
        }


        let form = rules-&gt;getCategory(count);

        // Return the translation for that form
        return this-&gt;get(str, form, lang);
    }

    /**
     * Plural rules lazy initialization.
     * 
     * @param string code Language code
     * @return object
     */
    protected function pluralRules(string code)
    {
        if code === &quot;pl&quot; {
            return new Plural\Polish;
        } elseif code === &quot;ar&quot; {
            return new Plural\Arabic;
        } elseif in_array(code, [&quot;cs&quot;, &quot;sk&quot;], true) {
            return new Plural\Czech;
        } elseif in_array(code, [&quot;ru&quot;, &quot;sr&quot;, &quot;uk&quot;, &quot;sh&quot;, &quot;be&quot;, &quot;hr&quot;, &quot;bs&quot;], true) {
            return new Plural\Balkan;
        } elseif in_array(code, [&quot;fr&quot;, &quot;ff&quot;, &quot;kab&quot;], true) {
            return new Plural\French;
        } elseif in_array(code, [&quot;mo&quot;, &quot;ro&quot;], true) {
            return new Plural\Romanian;
        } elseif in_array(code, [&quot;hi&quot;, &quot;ln&quot;, &quot;mg&quot;, &quot;ak&quot;, &quot;tl&quot;, &quot;am&quot;, &quot;bh&quot;, &quot;wa&quot;, &quot;ti&quot;, &quot;guw&quot;, &quot;fil&quot;, &quot;nso&quot;], true) {
            return new Plural\Zero;
        } elseif in_array(code, [
            &quot;en&quot;, &quot;ny&quot;, &quot;nr&quot;, &quot;no&quot;, &quot;om&quot;, &quot;os&quot;, &quot;ps&quot;, &quot;pa&quot;, &quot;nn&quot;, &quot;or&quot;, &quot;nl&quot;, &quot;lg&quot;, &quot;lb&quot;, &quot;ky&quot;, &quot;ml&quot;, &quot;mr&quot;,
            &quot;ne&quot;, &quot;nd&quot;, &quot;nb&quot;, &quot;pt&quot;, &quot;rm&quot;, &quot;ts&quot;, &quot;tn&quot;, &quot;tk&quot;, &quot;ur&quot;, &quot;vo&quot;, &quot;zu&quot;, &quot;xh&quot;, &quot;ve&quot;, &quot;te&quot;, &quot;ta&quot;, &quot;sq&quot;,
            &quot;so&quot;, &quot;sn&quot;, &quot;ss&quot;, &quot;st&quot;, &quot;sw&quot;, &quot;sv&quot;, &quot;ku&quot;, &quot;mn&quot;, &quot;et&quot;, &quot;eo&quot;, &quot;el&quot;, &quot;eu&quot;, &quot;fi&quot;, &quot;fy&quot;, &quot;fo&quot;, &quot;ee&quot;,
            &quot;dv&quot;, &quot;bg&quot;, &quot;af&quot;, &quot;bn&quot;, &quot;ca&quot;, &quot;de&quot;, &quot;da&quot;, &quot;gl&quot;, &quot;es&quot;, &quot;it&quot;, &quot;is&quot;, &quot;ks&quot;, &quot;ha&quot;, &quot;kk&quot;, &quot;kl&quot;, &quot;gu&quot;,
            &quot;brx&quot;, &quot;mas&quot;, &quot;teo&quot;, &quot;chr&quot;, &quot;cgg&quot;, &quot;tig&quot;, &quot;wae&quot;, &quot;xog&quot;, &quot;ast&quot;, &quot;vun&quot;, &quot;bem&quot;, &quot;syr&quot;, &quot;bez&quot;, &quot;asa&quot;,
            &quot;rof&quot;, &quot;ksb&quot;, &quot;rwk&quot;, &quot;haw&quot;, &quot;pap&quot;, &quot;gsw&quot;, &quot;fur&quot;, &quot;saq&quot;, &quot;seh&quot;, &quot;nyn&quot;, &quot;kcg&quot;, &quot;ssy&quot;, &quot;kaj&quot;, &quot;jmc&quot;,
            &quot;nah&quot;, &quot;ckb&quot;], true) {
            return new Plural\One;
        } elseif in_array(code, [&quot;se&quot;, &quot;kw&quot;, &quot;iu&quot;, &quot;smn&quot;, &quot;sms&quot;, &quot;smj&quot;, &quot;sma&quot;, &quot;naq&quot;, &quot;smi&quot;], true) {
            return new Plural\Two;
        } elseif in_array(code, [
            &quot;my&quot;, &quot;sg&quot;, &quot;ms&quot;, &quot;lo&quot;, &quot;kn&quot;, &quot;ko&quot;, &quot;th&quot;, &quot;to&quot;, &quot;yo&quot;, &quot;zh&quot;, &quot;wo&quot;, &quot;vi&quot;, &quot;tr&quot;, &quot;az&quot;, &quot;km&quot;, &quot;id&quot;,
            &quot;ig&quot;, &quot;fa&quot;, &quot;dz&quot;, &quot;bm&quot;, &quot;bo&quot;, &quot;ii&quot;, &quot;hu&quot;, &quot;ka&quot;, &quot;jv&quot;, &quot;ja&quot;, &quot;kde&quot;, &quot;ses&quot;, &quot;sah&quot;, &quot;kea&quot;], true) {
            return new Plural\None;
        } else {
            throw new Exception(&quot;Unknown language code: &quot; . code);
        }
    }

    /**
     * Alias of translate.
     */
    public function _(string! str, array values = null, var context = null, string lang = null) -&gt; string
    {
        return this-&gt;translate(str, values, lang);
    }

    /**
     * Translation/internationalization function. strtr() or sprintf is used for replacing parameters.
     *
     * @param string string Text to translate
     * @param array values Values to replace in the translated text
     * @param mixed context String form or numeric count
     * @param string lang Source language
     * @return string
     */
    public function translate(string! str, array values = null, var context = null, string lang = null) -&gt; string
    {
        if !lang {
            let lang = (string) this-&gt;options[&quot;lang&quot;];
        }

        if is_numeric(context) {
            // Get plural form
            let str = this-&gt;plural(str, context, lang);
        } else {
            // Get custom form
            let str = this-&gt;get(str, context, lang);
        }

        if !count(values) {
            return str;
        } else {
            // Check if values is associative or sequential
            if count(array_filter(array_keys(values), &quot;is_string&quot;)) {
                return strtr(str, values);
            } else {
                return call_user_func_array(&quot;sprintf&quot;, array_merge([str], values));
            }
        }
    }
}
</code></pre>                    </div>
                </div>
            </div>
        </div>

        <script src="../../asset/static/js/jquery.min.js"></script>
        <script src="../../asset/static/js/bootstrap.min.js"></script>
        <script src="../../asset/static/js/highlight.pack.js"></script>
        <script src="../../asset/static/js/jquery.slimscroll.min.js"></script>
        <script src="../../asset/api_definition.js"></script>

        <script>var ZepCurrentPath = '../../'</script>
        <script src="../../asset/static/js/script.js"></script>
        <script type="text/javascript">
            $(window).on("load resize", function() {
                $('#menu-wrapper').slimscroll({ height: $(window).height() - 100, size: '3px' });
            });
        </script>
        <script type="text/javascript">
            $(document).ready(function() { $('pre code').each(function(i, block) { hljs.highlightBlock(block); }); });
            if ($('.zephir-source-file').length) {
                $('link[id]').each(function(i, link) {
                    link.disabled = (link.id != 'tomorrow-night');
                });
            }
        </script>
            </body>
</html>